// ğŸ“ telegramTriggers.js â€“ ×©××™×¨×” ××œ××” ×¢×œ ×›×œ ×”×ª×’×•×‘×•×ª ×”××§×•×¨×™×•×ª + ×¡×“×¨ ×—×›×

const linkRegex = /(https?:\/\/[^\s]+)/i;

const linkReplies = [
  "××” ×–×” ×”×œ×™× ×§ ×”×–×” ×™× × ×•××©?",
  "×¢×•×“ ×¤×¢× ×œ×™× ×§? ×ª×œ××“ ×œ×—×™×•×ª ×‘×¢×•×œ× ×”×××™×ª×™",
  "×× ×–×” ×œ× ×§×©×•×¨ ×œÖ¾Warzone ×ª××—×•×§ ××ª ×–×” ××™×“",
  "×©××¢×ª×™ ×©×™×© ×˜×™×¤×•×œ ×œ×§×œ×™×§Ö¾××—×œ×”",
  "×¨×§ ××œ ×ª×’×™×“ ×©×–×” ×¡×¨×˜×•×Ÿ ×˜×™×§×˜×•×§",
  "×× ×–×” ×¤×•×¨× ×• â€“ ×œ×¤×—×•×ª ×©×ª×£ ×¢× ×ª×™××•×¨",
  "×× ×–×” ×—×™× ××™ â€“ ×©×œ×— ×œ×™ ×‘×¤×¨×˜×™",
  "×©××¢×•×Ÿ ××•×—×§ × ×§×•×“×•×ª ×›×œ ×¤×¢× ×©××ª×” ××©×ª×£ ×›×›×”",
  "×”××©×˜×¨×” ×›×‘×¨ ××™×ª×š ×¢×œ ×”×§×•",
  "×©×•×œ×— ×œ×™× ×§×™× ×›××• ××™×× ×©×œ×š ×‘×‘×•×§×¨.",
  "×›×‘×¨ ×¢×“×™×£ ×©×ª×©×œ×— ×’×™×£ ×©×œ ×¤×™×¦×”",
  "×›×œ ×¤×¢× ×©××ª×” ×©×•×œ×— ×œ×™× ×§, ×™×•×’×™ ××¤×¡×™×“ ×‘Ö¾Rocket League.",
  "×¨×•×¢×™ ×¤×¨×© ××”×§×‘×•×¦×” ×‘×’×œ×œ ×–×”.",
  "×©×•×œ×— ×œ×™× ×§ ×•×—×•×©×‘ ×©×¡×™×™× ××ª ×ª×¤×§×™×“×•.",
  "×”×¢×•×œ× ×œ× ××•×›×Ÿ ×œ××” ×©×©×œ×—×ª ×›×¨×’×¢.",
  "×œ×™× ×§ ×‘×œ×™ ×œ×”×¡×‘×™×¨ â€“ ×‘×•×©×” ×•×—×¨×¤×”.",
  "×ª×’×™×“, ××” ×× ×—× ×• ×××•×¨×™× ×œ×¢×©×•×ª ×¢× ×–×”?",
  "× ×• ×‘×××ª, ×œ×™× ×§ ×‘××§×•× ×œ×ª×™×™×’?",
  "×›× ×¨××” ×™×© ×œ×š ×™×•×ª×¨ ×œ×™× ×§×™× ×××™×œ×™×.",
  "×™××œ×œ×” ×‘××× ×©×œ×š, ×“×™ ×›×‘×¨."
];

const keywordTriggers = {
  ××©×—×§: [
    "××™ ××©×—×§? ×›× ×¨××” ×œ× ××ª×”...",
    "×ª×©××œ ××ª ××× ×× ××•×ª×¨ ×œ×š ×œ×©×—×§",
    "×©×•××œ ×›×œ ×©×‘×•×¢, ×œ× ××—×•×‘×¨ ××£ ×¤×¢×",
    "×”×’×™×¢ ×”×–××Ÿ ×©×ª×¤×¡×™×§ ×œ×©××•×œ ×•×ª×ª×—×™×œ ×œ×¤×¢×•×œ",
    "×©××¢×•×Ÿ ×©×•× × ×—×•×¡×¨ ×”×—×œ×˜×™×•×ª. ×ª×™×›× ×¡ ××• ×ª×©×ª×•×§.",
    "×©×•×‘ ××ª×” ×¢× ×”×©××œ×” ×”×–××ª? ×ª×©×ª× ×” ×›×‘×¨",
    "××¢× ×™×™×Ÿ ××™×š ××ª×” ×©×•××œ ×•×œ× ××©×—×§...",
    "×ª×‘×“×•×§ ×× ×”×›×‘×œ ×©×œ ×”××™×§×¨×•×¤×•×Ÿ ××—×•×‘×¨ ×§×•×“×",
    "××ª×” ×©×•××œ '××™ ××©×—×§' ×›×‘×¨ 3 ×©× ×™×. ×ª×‘×™×Ÿ ×œ×‘×“.",
    "×¨×•×¢×™ ×¢×¡×•×§ ×‘Ö¾Helldivers 2, ×™×•×’×™ ×©×•×‘ ×‘×¨×•×§×˜ ×œ×™×’"
  ],
  ×¢×•×œ×”: [
    "×”×§×‘×•×¦×” ×œ× ×¦×¨×™×›×” ××•×ª×š",
    "××£ ××—×“ ×œ× ×‘×™×§×© ×©×ª×¢×œ×”",
    "××ª×” ×¢×•×œ×”? ×ª×•×“×™×¢ ×©× ×›×‘×” ×©×¨×ª",
    "×©××¢×•×Ÿ ×œ× ×××©×¨ ×¢×œ×™×™×” ×‘×œ×™ ××™×©×•×¨ ××™×œ×•××™×",
    "×¤×—×•×ª ×”×•×“×¢×•×ª, ×™×•×ª×¨ ×¢×œ×™×•×ª",
    "×‘×•× × ×¨××” ××•×ª×š ×¢×•×œ×” ×‘×××ª, ×œ× ×¨×§ ××“×‘×¨",
    "××ª×™ ×‘×¤×¢× ×”××—×¨×•× ×” ×‘×××ª ×¢×œ×™×ª?",
    "×©××¢×•×Ÿ ×›×‘×¨ ××™×‘×“ ×¡×‘×œ× ×•×ª",
    "×”×©×¨×ª ×¨×•×¢×“ ××¨×•×‘ ×¢×œ×™×•×ª ××–×•×™×¤×•×ª",
    "×¨×§ ××œ ×ª×©××™×¨ ××™×§×¨×•×¤×•×Ÿ ×¤×ª×•×—"
  ],
  ××—×•×‘×¨: [
    "×©××¢×•×Ÿ ×ª××™×“ ××—×•×‘×¨. ××ª×” ×œ×.",
    "××—×•×‘×¨ ×‘×œ×‘, ×× ×•×ª×§ ×‘××™×™×¤×•×Ÿ",
    "××—×•×‘×¨? ×’× ×× ×™. ××– ××”?",
    "×©×•×‘ ××ª×” ×‘×•×“×§ ×× ××™×©×”×• ×¨×•××” ××•×ª×š",
    "×”×× ×–×” ××—×•×‘×¨ ××• ×©××ª×” ×¡×ª× ××—×¤×© ×ª×©×•××ª ×œ×‘?",
    "×ª×ª× ×ª×§ ×•×ª×ª×—×‘×¨ ×œ×—×™×™× ×”×××™×ª×™×™×",
    "×”×—×™×‘×•×¨ ×©×œ×š ×¤×—×•×ª ×™×¦×™×‘ ××”××™×§×¨×•×¤×•×Ÿ ×©×œ ××ª×Ÿ",
    "×× ×”×™×™×ª ×‘×××ª ××—×•×‘×¨, ×”×™×™×ª ×©×§×˜ ×›×‘×¨",
    "××—×•×‘×¨, ××‘×œ ×‘× ×©××” ×œ× ×‘××©×—×§",
    "×—×™×‘×¨×ª ×’× ××ª ×”××•×–× ×™×•×ª ××• ×¨×§ ××ª ×”×¢×¦×‘×™×?"
  ],
  ××—×™: [
    "×× ×™ ×œ× ××— ×©×œ×š. ×“×‘×¨ ×‘×¨×•×¨.",
    "×¤×¢× ××—×¨×•× ×” ×©××™×©×”×• ×§×¨× ×œ×™ ××—×™, ×–×” × ×’××¨ ×‘××™×•×˜",
    "×©××¢×•×Ÿ ×œ× ××•×”×‘ ××—×•×§×™×. ×¨×§ ×’×‘×¨×™×",
    "×ª×’×™×“ ××—×™ ×¢×•×“ ×¤×¢× ××—×ª ×•×× ×™ ×©×•×œ×— ××•×ª×š ×œ×’×•×œ××’",
    "×ª×’×™×“ ×©×, ×œ× ××—×™. ×©××•×¨ ×¢×œ ×›×‘×•×“",
    "××—×™ ××—×™ ××—×™... × ×××¡",
    "×¤×¢× ×§×¨××• ×œ×™ ××—×™. ×¢×›×©×™×• ×”× ×©×•×ª×§×™×",
    "×™××œ×œ×”, ××—×™... ×œ×š ×ª×¢×©×” ××©×”×• ×¢× ×¢×¦××š",
    "×©××¢×•×Ÿ ×œ× ××ª×—×‘×¨ ×œ××™ ×©×§×•×¨× ×œ×• ××—×™",
    "×ª×¤×¡×™×§ ×œ×§×¨×•× ×œ×™ ××—×™, ×× ×—× ×• ×œ× ××©×¤×—×”"
  ]
};

let lastMessageTimestamp = 0;
let dailyReminderSent = false;

function getRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function handleTrigger(ctx) {
  const text = ctx.message?.text?.toLowerCase() || "";
  const name = ctx.from?.first_name || "×—×‘×¨";

  // ğŸ”— ×œ×™× ×§
  if (linkRegex.test(text)) {
    ctx.reply(`ğŸ”— ${name}, ${getRandom(linkReplies)}`);
    lastMessageTimestamp = Date.now();
    return true;
  }

  // ğŸ§  ××™×œ×•×ª ××¤×ª×—
  for (const keyword in keywordTriggers) {
    if (text.includes(keyword)) {
      ctx.reply(`ğŸ¤– ${name}, ${getRandom(keywordTriggers[keyword])}`);
      lastMessageTimestamp = Date.now();
      return true;
    }
  }

  // ğŸ–¼ï¸ ×ª××•× ×”
  if (ctx.message?.photo) {
    ctx.reply("ğŸ“¸ ×©×œ×—×ª ×ª××•× ×” â€“ ××‘×œ ×œ××”? ×ª×¡×‘×™×¨.");
    lastMessageTimestamp = Date.now();
    return true;
  }

  // ğŸ­ ×¡×˜×™×§×¨
  if (ctx.message?.sticker) {
    ctx.reply("ğŸ­ ×¡×˜×™×§×¨ ×‘××§×•× ×˜×§×¡×˜? ×©××¢×•×Ÿ ×©×•×§×œ ×§×™×§.");
    lastMessageTimestamp = Date.now();
    return true;
  }

  lastMessageTimestamp = Date.now();
  return false;
}

// â° ×ª×–×›×•×¨×ª ×× ×œ× ×›×ª×‘×• ×›×œ×•× ××¢×œ 24 ×©×¢×•×ª
function checkDailySilence(bot, chatId) {
  const hours = (Date.now() - lastMessageTimestamp) / 1000 / 60 / 60;
  if (hours > 24 && !dailyReminderSent) {
    bot.api.sendMessage(chatId, "ğŸ“¢ ×©×§×˜ ×›×–×” ×œ× ×”×™×” ×××– ×©×™×•×’×™ ×©×‘×¨ ×©×œ×˜. ××™×©×”×• ×›××Ÿ?");
    dailyReminderSent = true;
  }
}

module.exports = {
  handleTrigger,
  checkDailySilence
};
