// telegramTriggers.js
const linkResponses = [
  "מה זה הלינק הזה יא נואש?",
  "עוד פעם לינק? תלמד לחיות בעולם האמיתי",
  "אם זה לא קשור ל־Warzone תמחוק את זה מיד",
  "שמעתי שיש טיפול לקליק־מחלה",
  "רק אל תגיד שזה סרטון טיקטוק",
  "אם זה פורנו – לפחות שתף עם תיאור",
  "אם זה חינמי – שלח לי בפרטי",
  "שמעון מוחק נקודות כל פעם שאתה משתף ככה",
  "המשטרה כבר איתך על הקו",
  "אתה והלינקים שלך כמו פינג בלי אינטרנט",
  "וואו, ממש גאון. שלחת לינק. מחיאות כפיים 👏",
  "שמעון שונא לינקים. תתאפס.",
  "נו באמת, לינק במקום לתייג?",
  "עוד לינק כזה ותופיע לך נבואה מהשטן",
  "שלחת לינק. מגיע לך לוזר של השבוע",
  "האם זה לינק חוקי? כי FBI מחכים בכניסה",
  "שמעון לא לוחץ על לינקים. רק על שחקנים.",
  "אתה חושב שהלינק הזה יעשה אותך MVP?",
  "כבר עדיף שתשלח גיף של פיצה",
  "תנסה לשלוח פחות שטויות – זה בריא לנשמה"
];

const keywordTriggers = {
  משחק: [
    "מי משחק? כנראה לא אתה...",
    "תשאל את אמא אם מותר לך לשחק",
    "אם תיכנס לשיחה במקום לשאול, תדע לבד",
    "שוב אתה עם השאלה הזאת? תשתנה כבר",
    "שמעון שונא חוסר החלטיות. תיכנס או תשתוק.",
    "מעניין איך אתה שואל ולא משחק...",
    "שואל כל שבוע, לא מחובר אף פעם",
    "הגיע הזמן שתפסיק לשאול ותתחיל לפעול",
    "תבדוק אם הכבל של המיקרופון מחובר קודם",
    "אתה שואל 'מי משחק' כבר 3 שנים. תבין לבד."
  ],
  עולה: [
    "הקבוצה לא צריכה אותך",
    "אף אחד לא ביקש שתעלה",
    "רק אל תשאיר מיקרופון פתוח",
    "אתה עולה? תודיע שנכבה שרת",
    "שמעון לא מאשר עלייה בלי אישור מילואים",
    "רק אם אתה מביא נובל",
    "בוא נראה אותך עולה באמת, לא רק מדבר",
    "פחות הודעות, יותר עליות",
    "מתי בפעם האחרונה באמת עלית?",
    "אל תבנה על זה שיחכו לך"
  ],
  מחובר: [
    "שמעון תמיד מחובר. אתה לא.",
    "מחובר, אבל בנשמה לא במשחק",
    "האם חיברת גם את האוזניות?",
    "שוב אתה בודק אם מישהו רואה אותך",
    "החיבור שלך פחות יציב מהמיקרופון של מתן",
    "מחובר בלב, מנותק באייפון",
    "האם זה מחובר או שאתה סתם מחפש תשומת לב?",
    "אולי תתנתק ותתחבר לחיים האמיתיים",
    "מחובר? גם אני. אז מה?",
    "אם היית באמת מחובר, היית שקט כבר"
  ],
  אחי: [
    "אני לא אח שלך. דבר ברור.",
    "תפסיק לקרוא לי אחי, אנחנו לא משפחה",
    "פעם אחרונה שמישהו קרא לי אחי, זה נגמר במיוט",
    "שמעון לא אוהב אחוקים. רק גברים",
    "תגיד אחי עוד פעם אחת ואני שולח אותך לגולאג",
    "אחי אחי אחי... נמאס",
    "תגיד שם, לא אחי. שמור על כבוד",
    "שמעון לא מתחבר למי שקורא לו אחי",
    "פעם קראו לי אחי. עכשיו הם שותקים",
    "יאללה, אחי... לך תעשה משהו עם עצמך"
  ]
};

function getRandom(array) {
  return array[Math.floor(Math.random() * array.length)];
}

function handleTrigger(ctx) {
  const text = ctx.message?.text || "";
  const name = ctx.from?.first_name || "חבר";

  // 🔗 לינק
  if (text.match(/https?:\/\/|www\./i)) {
    return ctx.reply(`🤖 ${name}, ${getRandom(linkResponses)}`);
  }

  // 🧠 טריגרים מילוליים
  for (const keyword in keywordTriggers) {
    if (text.toLowerCase().includes(keyword)) {
      return ctx.reply(`🤖 ${name}, ${getRandom(keywordTriggers[keyword])}`);
    }
  }
}

module.exports = { handleTrigger };
