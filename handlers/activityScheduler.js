const { TextChannel } = require('discord.js');

const WARZONE_ROLE_ID = process.env.ROLE_WARZONE_ID;
const TARGET_TEXT_CHANNEL_ID = '583575179880431616';

const warzoneMessages = [
  'ðŸ”¥ ×™×© ×¤×” ×ž×œ×—×ž×” ××• ×›×•×œ× ×¢×•×©×™× × ×¢× ×¢ ×¢× ×¤×™× ×’ 900?',
  'ðŸŽ¯ ×©×œ×•×©×” ×©×—×§× ×™ ×•×•×¨×–×•×Ÿ ××•× ×œ×™×™×Ÿ ×•××£ ××—×“ ×œ× ×‘×¢×¨×•×¥... ×ž×¢× ×™×™×Ÿ ðŸ¤¨',
  'ðŸ‘€ ×ž×™×©×”×• ××ž×¨ Warzone? ×‘×•××• ×œ×¢×¨×•×¥, ××•×œ×™ ×™×§×¨×” ×§×¡×!',
  'ðŸ’€ ×¤×™× ×’ ×©×œ ××œ×•×¤×™× â€“ ×ž×™ ×ž×•×›×Ÿ ×œ×”×ª××‘×“ ××™×ª×™ ×‘××•×ª×• ×’×’?',
  'ðŸš¨ ALERT: ×•×•×¨×–×•×Ÿ ××•×Ÿ ××‘×œ ××£ ××—×“ ×œ× ×‘×¡×§×•×•×“! ××™×¤×” ×”×›×‘×•×“?',
  'ðŸ˜´ ×›×•×œ× ×ž×—×•×‘×¨×™×, ××£ ××—×“ ×œ× ×ž×“×‘×¨ â€“ ×–×” ×©×¨×ª ××• ×‘×™×ª ×§×‘×¨×•×ª?',
  'ðŸ§± ×¤×™× ×’×™× ×’×‘×•×”×™×, ×ž×•×˜×™×‘×¦×™×” × ×ž×•×›×” â€“ ×›×›×” ×œ× ×‘×•× ×™× ×—×•×ž×”!',
  'ðŸŽ® ××ª× ×œ× ×ž×—×•×‘×¨×™×, ××ª× ×ž×—×•×‘×§× ×™×. ×‘×•××• ×œ×¢×¨×•×¥ ×›×‘×¨!',
  'ðŸ§  × ×•×›×—×•×ª ×’×‘×•×”×”, ×‘×™×¦×•×¢×™× × ×ž×•×›×™× â€“ ×§×œ××¡×™×§ ×©×œ ×”×©×¨×ª ×”×–×”.',
  'ðŸŒ ××¤×™×œ×• ×”×“×™×¡×§×•×¨×“ ×ž×¨×’×™×© ×›×ž×” ××ª× ××™×˜×™×™× ×”×™×•×...',
  'ðŸ‘» ×™×© ×¤×” ×¨×•×—×•×ª ×¨×¤××™× ×ž×—×•×¤×©×•×ª ×œ×©×—×§× ×™×. ×ž×™×©×”×• ×ž×•×›×Ÿ ×œ×”×•×¤×™×¢?',
  'ðŸ“‰ ×”×ž×•×¨×œ ×‘×©×¨×ª ×”×–×” ×›×ž×• KD ×©×œ×™ â€“ ×‘×ª×—×ª×™×ª.',
  'ðŸ† ×× ×”×™×™×ª× ×ž×©×§×™×¢×™× ×‘×§×•×œ ×›×ž×• ×‘×‘××˜×œ-×¤×¡ ×”×™×™× ×• ×›×‘×¨ ×‘×œ×™×’×”.',
  'ðŸ— ×‘×•××• ×œ×¢×¨×•×¥ ×•× ×¢×©×” ×œ×•×‘×™, ×œ× ×¢×œ ×”××©. ××• ×©×›×Ÿ?',
  'âš”ï¸ ×©×ž×¢×•×Ÿ ×§×•×¨× ×œ×§×¨×‘! ×ª×ª×™×™×¦×‘×• ××• ×ª×§×‘×œ×• ×›×™× ×•×™ ×ž×”-TTS!',
  'ðŸ“¢ ×ž×™ ×©×ž×’×™×¢ ×œ×¢×¨×•×¥ ×¢×›×©×™×• â€“ ×ž×§×‘×œ × ×§×•×“×ª ×›×‘×•×“. ×ž×™ ×©×œ× â€“ ×¡× ×§×¦×™×”!',
  'ðŸ‘¨â€ðŸ‘¦â€ðŸ‘¦ ×›×•×œ× ×ž×—×•×‘×¨×™× ××‘×œ ×ž×ª× ×”×’×™× ×›×ž×• ×¡×•×œ×•××™×. ××™×¤×” ×”×§×œ××Ÿ?',
  'ðŸ˜¡ ××œ ×ª×’×™×“×• ×œ×™ ××—"×› ×©××™×Ÿ ×¢× ×ž×™ ×œ×©×—×§. ×ª×ª×—×™×œ×• ×œ×”×•×¤×™×¢!',
  'ðŸ”‡ ×©×§×˜ ×‘×¢×¨×•×¥ = ×‘×•×©×” ×‘×©×¨×ª. ×ª×¨××• ×ž×™ ××ª× ×‘××ž×ª.',
  'ðŸ“¦ ×©×—×§× ×™ Warzone ×¢×œ ×”× ×™×™×¨. ×‘×¢×¨×•×¥? × ×¢×œ×ž×™× ×›×ž×• Supply Drop.',
  'ðŸŽ¤ ××—×“... ×©×ª×™×™×... ×‘×“×™×§×”... ×ž×™×©×”×• ×¤×” ×‘×›×œ×œ ×ž×©×—×§ ××• ×¨×§ ×¦×•×¤×” ×‘×™×•×˜×™×•×‘?',
  'ðŸ’¡ ×¨×¢×™×•×Ÿ: ×ª×ª×—×‘×¨×• ×œ×¢×¨×•×¥ ×•×ª×’×™×“×• ×©×œ×•×. ×œ× ×™×§×¨×” ×›×œ×•×, ×ž×‘×˜×™×—.'
];


function getRandomMsg() {
  return warzoneMessages[Math.floor(Math.random() * warzoneMessages.length)];
}

async function checkWarzoneActivity(client) {
  const guild = client.guilds.cache.first();
  if (!guild) return;

  await guild.members.fetch();
  const channel = guild.channels.cache.get(TARGET_TEXT_CHANNEL_ID);
  if (!(channel instanceof TextChannel)) return;

  const warzonePlayers = guild.members.cache.filter(m =>
    m.roles.cache.has(WARZONE_ROLE_ID) && !m.user.bot
  );

  const onlineWarzoners = warzonePlayers.filter(m =>
    ['online', 'dnd', 'idle'].includes(m.presence?.status)
  );

  const inVoice = warzonePlayers.filter(m => m.voice?.channel);

  if (onlineWarzoners.size >= 3 && inVoice.size === 0) {
    channel.send(getRandomMsg()).catch(() => {});
  }
}

function startActivityScheduler(client) {
  // ×¨×¥ ×›×œ ×©×¢×ª×™×™× (××¤×©×¨ ×œ×©× ×•×ª ×œ×¤×™ ×”×¦×•×¨×š)
  setInterval(() => {
    checkWarzoneActivity(client);
  }, 1000 * 60 * 60 * 2);
}

module.exports = { startActivityScheduler };
